---
layout: center
---

# The server entry

````md magic-move
```tsx
import { eventHandler } from "vinxi/http";
import { renderToPipeableStream } from "react-dom/server";
import { getManifest } from "vinxi/manifest";
import App from "./App";
```

```tsx {1|2|5-14|6-8|9-11|12-14|18}
export default eventHandler(async (event) => {
  const clientManifest = getManifest("client");

  const stream = await new Promise(async (resolve) => {
    const pStream = renderToPipeableStream(<App />, {
      onShellReady() {
        resolve(pStream);
      },
      bootstrapModules: [
        clientManifest.inputs[clientManifest.handler].output.path,
      ],
      bootstrapScriptContent: `window.manifest = ${JSON.stringify(
        await clientManifest.json(),
      )}`,
    });
  });

  event.node.res.setHeader("Content-Type", "text/html");
  return stream;
});
```
````

<!--

[click] `eventHandler`: Vinxi's function to wrap our server-side request handling logic.

[click] getManifest("client")`: Retrieves metadata about the client-side JavaScript bundle, generated by Vinxi during the build, using its Manifest API. In short, the Manifest API is the part that that makes different environments (server, browser) know the important information from every environment.

[click]`renderToPipeableStream(<App />)`: React's API to render the `<App>` component into a Node.js stream. This allows the browser to start receiving and rendering HTML before the entire response is generated.

[click]`onShellReady()`: A callback within `renderToPipeableStream`. It's called when the initial HTML structure (the "shell") is ready. We `resolve` the Promise here to send the stream back.

[click]`bootstrapModules`: Tells React which JavaScript file(s) to load on the client to hydrate the server-rendered HTML. We get the path from the client manifest.

[click]`bootstrapScriptContent`: Injects an inline `<script>` tag into the HTML stream. Here, we serialize the client manifest and assign it to `window.manifest`. This allows client-side code (like `@vinxi/react`'s `createAssets`) to access manifest information.

[click]`setHeader("Content-Type", "text/html")`: Ensures the browser correctly interprets the streamed response as HTML.
-->
